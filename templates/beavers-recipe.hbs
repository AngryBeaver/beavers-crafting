<div class="flexrow beavers-recipe">
    <div class="flexrow" style="flex-basis:auto">
        {{#if (or recipe.tests recipe.instruction)}}
            {{#if recipe.instruction}}
                <div class="flexcol" style="min-width:200px">
                    <div class="header">
                        {{localize "beaversCrafting.crafting-app.instruction"}}
                    </div>
                    <div class="section">
                        {{{recipe.instruction}}}
                    </div>
                </div>
            {{/if}}
            {{#if recipe.tests}}
                <div class="flexcol" style="min-width:200px">
                    <div class="header">
                        {{localize "beaversCrafting.crafting-app.checks"}}
                    </div>
                    <div class="flexrow section beavers-folder">
                        <div class="folder open">
                            <div class="flexrow folderName">
                                <div class="flexrow">
                                    <i style="flex:0;margin:5px" class="fas faw fa-clipboard"></i>
                                    <i style="flex:0;margin:5px" class="fas faw fa-clipboard-list-check"></i>
                                    {{localize "beaversCrafting.crafting-app.pass"}} {{maxHits}}
                                    {{#if (gt recipe.tests.fails 1)}}
                                        {{localize "beaversCrafting.crafting-app.before"}} {{recipe.tests.fails}}
                                        {{localize "beaversCrafting.crafting-app.fails"}}
                                    {{/if}}
                                </div>
                            </div>
                            <div class="folderContent">
                                {{#each recipe.tests.ands}}
                                    <div class="flexrow">
                                <span style="flex:0" class="flexcol">
                                    <span class="border top"></span>
                                    {{#if @last}}<span></span>{{else}}<span class="border"></span>{{/if}}
                                </span>
                                        <div class="test-section flexcol">
                                            <div class="flexrow test-header">
                                                {{hits}} times
                                            </div>
                                            {{#each this.ors}}
                                                <div class="flexrow">
                                                    {{>beavers-recipe-test test=this abilities=../../abilities skills=../../skills tools=../../tools}}
                                                </div>
                                                {{#unless @last}}
                                                    <div class="beavers-seperator"></div>
                                                {{/unless}}
                                            {{/each}}
                                        </div>
                                    </div>
                                {{/each}}
                            </div>
                        </div>
                    </div>
                </div>
            {{/if}}
        {{/if}}
    </div>
    <div class="flexrow" style="flex-basis:auto">
        {{#if chatData}}
            {{#if (not (beavers-isEmpty chatData.components.required))}}
                <div class="flexcol" style="min-width:200px">
                    <div class="header">
                        {{localize "beaversCrafting.crafting-app.required"}}
                    </div>
                    <div class="flexcol required section">
                        {{#each chatData.components.required}}
                            {{>beavers-recipe-component component=this.component key=@key clickable=../displayIngredients status=this.status}}
                            {{#unless @last}}
                                <div class="beavers-seperator"></div>
                            {{/unless}}
                        {{/each}}
                    </div>
                </div>
            {{/if}}
            {{#if (not (beavers-isEmpty chatData.components.consumed))}}
                <div class="flexcol" style="min-width:200px">
                    <div class="header">
                        {{localize "beaversCrafting.crafting-app.cost"}}
                    </div>
                    <div class="flexcol consumed section">
                        {{#each chatData.components.consumed}}
                            {{>beavers-recipe-component component=this.component key=@key clickable=../displayIngredients status=this.status}}
                            {{#unless @last}}
                                <div class="beavers-seperator"></div>
                            {{/unless}}
                        {{/each}}
                    </div>
                </div>
            {{/if}}
            {{#if (not (beavers-isEmpty chatData.components.produced))}}
                <div class="flexcol" style="min-width:200px">
                    <div class="header">
                        {{localize "beaversCrafting.crafting-app.result"}}
                    </div>
                    <div class="flexcol produced section">
                        {{#each chatData.components.produced}}
                            {{>beavers-recipe-component component=this.component key=@key clickable=../displayIngredients status=this.status}}
                            {{#unless @last}}
                                <div class="beavers-seperator"></div>
                            {{/unless}}
                        {{/each}}
                    </div>
                </div>
            {{/if}}
        {{else}}
            {{#if (not (beavers-isEmpty recipe.required))}}
                <div class="flexcol" style="min-width:200px">
                    <div class="header">
                        {{localize "beaversCrafting.crafting-app.required"}}
                    </div>
                    <div class="flexcol attendants section beavers-folder">
                        <div class="folder open">
                            {{#each recipe.required}}
                                <div class="folderContent">
                                    <div class="flexrow">
                                        <div style="flex:0" class="flexcol">
                                            <span class="border top"></span>
                                            {{#if @last}}<span></span>{{else}}<span class="border"></span>{{/if}}
                                        </div>
                                        <div class="data-section flexcol">
                                            {{#each this}}
                                                {{#if (gt (beavers-objectLen ../this) 1)}}
                                                <div class="flexrow">
                                                    <input class="choose" data-type="required" data-key="{{@key}}" data-group="{{@../key}}"
                                                           type="checkbox"/>
                                                {{/if}}
                                                {{>beavers-recipe-component component=this key=@key group=@../key clickable=../../displayResults status=(lookup (lookup ../../precast.required @../key) @key)}}
                                                {{#if (gt (beavers-objectLen ../this) 1)}}
                                                </div>
                                                {{/if}}
                                                {{#unless @last}}
                                                    <div style="margin-left:20px" class="beavers-seperator"></div>
                                                {{/unless}}
                                            {{/each}}
                                        </div>
                                    </div>
                                </div>
                            {{/each}}
                        </div>
                    </div>
                </div>
            {{/if}}
            {{#if (or currencyComponent (not (beavers-isEmpty recipe.input)))}}
                <div class="flexcol" style="min-width:200px">
                    <div class="header">
                        {{localize "beaversCrafting.crafting-app.cost"}}
                    </div>
                    <div class="flexcol ingredients section beavers-folder">
                        <div class="folder open">
                            {{#if currencyComponent}}
                                <div class="folderContent">
                                    <div class="flexrow">
                                        <div style="flex:0" class="flexcol">
                                            <span class="border top"></span>
                                            {{#if (beavers-isEmpty recipe.input)}}<span></span>{{else}}
                                                <span class="border"></span>{{/if}}
                                        </div>
                                        <div class="data-section flexcol">
                                            {{>beavers-recipe-component component=currencyComponent status=precast.currencies.status}}
                                        </div>
                                    </div>
                                </div>
                            {{/if}}
                            {{#if (not (beavers-isEmpty recipe.input))}}
                                {{#each recipe.input}}
                                    <div class="folderContent">
                                        <div class="flexrow">
                                            <div style="flex:0" class="flexcol">
                                                <span class="border top"></span>
                                                {{#if @last}}<span></span>{{else}}<span class="border"></span>{{/if}}
                                            </div>
                                            <div class="data-section flexcol">
                                                {{#each this}}
                                                    {{#if (gt (beavers-objectLen ../this) 1)}}
                                                    <div class="flexrow">
                                                        <input class="choose" data-type="input" data-key="{{@key}}"
                                                               data-group="{{@../key}}"
                                                               type="radio"/>
                                                    {{/if}}
                                                    {{>beavers-recipe-component component=this key=@key group=@../key clickable=../../displayIngredients status=(lookup (lookup ../../precast.input @../key) @key)}}
                                                    {{#if (gt (beavers-objectLen ../this) 1)}}
                                                    </div>
                                                    {{/if}}
                                                    {{#unless @last}}
                                                        <div style="margin-left:20px" class="beavers-seperator"></div>
                                                    {{/unless}}
                                                {{/each}}
                                            </div>
                                        </div>
                                    </div>
                                {{/each}}
                            {{/if}}
                        </div>
                    </div>
                </div>
            {{/if}}
            {{#if (not (beavers-isEmpty recipe.output))}}
                <div class="flexcol" style="min-width:200px">
                    <div class="header">
                        {{localize "beaversCrafting.crafting-app.result"}}
                    </div>
                    <div class="flexcol results section beavers-folder">
                        <div class="folder open">
                            {{#each recipe.output}}
                                <div class="folderContent">
                                    <div class="flexrow">
                                        <div style="flex:0" class="flexcol">
                                            <span class="border top"></span>
                                            {{#if @last}}<span></span>{{else}}<span class="border"></span>{{/if}}
                                        </div>
                                        <div class="data-section flexcol">
                                            {{#each this}}
                                                {{#if (gt (beavers-objectLen ../this) 1)}}
                                                <div class="flexrow">
                                                    <input class="choose" data-type="output" data-key="{{@key}}"
                                                           data-group="{{@../key}}"
                                                           type="radio"/>
                                                {{/if}}
                                                {{>beavers-recipe-component component=this key=@key group=@../key clickable=../../displayResults}}
                                                {{#if (gt (beavers-objectLen ../this) 1)}}
                                                </div>
                                                {{/if}}
                                                {{#unless @last}}
                                                    <div style="margin-left:20px" class="beavers-seperator"></div>
                                                {{/unless}}
                                            {{/each}}
                                        </div>
                                    </div>
                                </div>
                            {{/each}}
                        </div>
                    </div>
                </div>
            {{/if}}
        {{/if}}
    </div>
</div>